<div class="profile-page">
  <div class="profile-container">

    <!-- Sidebar Navigation -->
    <aside class="profile-sidebar">
      <div class="profile-preview">
        <div class="avatar-circle">
          <img *ngIf="imagePreview" [src]="imagePreview" alt="Profile">
          <div *ngIf="!imagePreview" class="avatar-fallback">
            {{ profileForm.value.firstName?.charAt(0) || 'U' }}
          </div>
        </div>

        <label class="change-photo">
          Change Photo
          <input type="file" hidden (change)="onFileChange($event)">
        </label>

        <h3 class="profile-name">
          {{ profileForm.value.firstName }} {{ profileForm.value.lastName }}
        </h3>
      </div>

      <nav class="sidebar-nav">
        <a class="nav-item" [class.active]="activeSection === 'profile'" (click)="scrollTo('profile')">Edit Profile</a>
        <a class="nav-item" [class.active]="activeSection === 'password'" (click)="scrollTo('password')">Change Password</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="profile-content">

      <!-- Profile Section -->
      <section id="profile" class="content-card">
        <h2 class="card-title">Edit Profile</h2>
        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">

          <div class="form-row">
            <div class="form-group full-width">
              <input type="text" placeholder="First Name" formControlName="firstName"
                class="form-input"
                [class.input-error]="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched">
              <small *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched" class="error-text">
                First name must be at least 2 characters
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="text" placeholder="Last Name" formControlName="lastName"
                class="form-input"
                [class.input-error]="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched">
              <small *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched" class="error-text">
                Last name must be at least 2 characters
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="text" placeholder="Headline" formControlName="headline" maxlength="60" class="form-input">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <textarea placeholder="Biography" formControlName="biography" class="form-textarea" rows="6" maxlength="1000"></textarea>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <select formControlName="language" class="form-select">
                <option *ngFor="let lang of languageOptions" [value]="lang">{{ lang }}</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="isLoading || profileForm.invalid">
              {{ isLoading ? 'Saving...' : 'Save' }}
            </button>
          </div>

          <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
          <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

        </form>
      </section>

      <!-- Change Password Section -->
      <section id="password" class="content-card">
        <h2 class="card-title">Change Password</h2>
        <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()">

          <div class="form-row">
            <div class="form-group full-width">
              <input type="password" placeholder="Current Password" formControlName="currentPassword" class="form-input"
                [class.input-error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="password" placeholder="New Password" formControlName="newPassword" class="form-input"
                [class.input-error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="password" placeholder="Confirm New Password" formControlName="confirmNewPassword" class="form-input"
                [class.input-error]="(passwordForm.get('confirmNewPassword')?.invalid && passwordForm.get('confirmNewPassword')?.touched) || passwordForm.errors?.['passwordMismatch']">
              <small *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmNewPassword')?.touched" class="error-text">
                Passwords do not match
              </small>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="isPasswordLoading || passwordForm.invalid">
              {{ isPasswordLoading ? 'Changing...' : 'Change Password' }}
            </button>
          </div>

          <div *ngIf="passwordSuccessMessage" class="alert alert-success">{{ passwordSuccessMessage }}</div>
          <div *ngIf="passwordErrorMessage" class="alert alert-error">{{ passwordErrorMessage }}</div>

        </form>
      </section>

    </main>
  </div>
</div>
