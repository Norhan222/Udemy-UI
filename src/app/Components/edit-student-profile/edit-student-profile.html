<div class="profile-page">
  <div class="profile-container">

    <!-- Sidebar Navigation -->
    <aside class="profile-sidebar">
      <div class="profile-preview">
        <div class="avatar-circle">
          <img *ngIf="imagePreview" [src]="imagePreview" alt="Profile">
          <div *ngIf="!imagePreview" class="avatar-fallback">
            {{ profileForm.value.firstName?.charAt(0) || 'U' }}
          </div>
        </div>

        <label class="change-photo">
          {{ 'PROFILE.CHANGE_PHOTO' | translate }}
          <input type="file" hidden (change)="onFileChange($event)">
        </label>

        <h3 class="profile-name">
          {{ profileForm.value.firstName }} {{ profileForm.value.lastName }}
        </h3>
      </div>

      <nav class="sidebar-nav">
        <a class="nav-item" [class.active]="activeSection === 'profile'" (click)="scrollTo('profile')">{{
          'PROFILE.EDIT_PROFILE' | translate }}</a>
        <a class="nav-item" [class.active]="activeSection === 'password'" (click)="scrollTo('password')">{{
          'PROFILE.CHANGE_PASSWORD' | translate }}</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="profile-content">

      <!-- Profile Section -->
      <section id="profile" class="content-card">
        <h2 class="card-title">{{ 'PROFILE.EDIT_PROFILE' | translate }}</h2>
        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">

          <div class="form-row">
            <div class="form-group full-width">
              <input type="text" [placeholder]="'PROFILE.FIRST_NAME' | translate" formControlName="firstName"
                class="form-input"
                [class.input-error]="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched">
              <small *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched"
                class="error-text">
                {{ 'PROFILE.FIRST_NAME_ERROR' | translate }}
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="text" [placeholder]="'PROFILE.LAST_NAME' | translate" formControlName="lastName"
                class="form-input"
                [class.input-error]="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched">
              <small *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched"
                class="error-text">
                {{ 'PROFILE.LAST_NAME_ERROR' | translate }}
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="text" [placeholder]="'PROFILE.HEADLINE' | translate" formControlName="headline"
                maxlength="60" class="form-input">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <textarea [placeholder]="'PROFILE.BIOGRAPHY' | translate" formControlName="biography"
                class="form-textarea" rows="6" maxlength="1000"></textarea>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <select formControlName="language" class="form-select">
                <option *ngFor="let lang of languageOptions" [value]="lang">{{ lang }}</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="isLoading || profileForm.invalid">
              {{ isLoading ? ('PROFILE.SAVING' | translate) : ('PROFILE.SAVE' | translate) }}
            </button>
          </div>

          <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
          <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

        </form>
      </section>

      <!-- Change Password Section -->
      <section id="password" class="content-card">
        <h2 class="card-title">{{ 'PROFILE.CHANGE_PASSWORD' | translate }}</h2>
        <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()">

          <div class="form-row">
            <div class="form-group full-width">
              <input type="password" [placeholder]="'PROFILE.CURRENT_PASSWORD' | translate"
                formControlName="currentPassword" class="form-input"
                [class.input-error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="password" [placeholder]="'PROFILE.NEW_PASSWORD' | translate" formControlName="newPassword"
                class="form-input"
                [class.input-error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <input type="password" [placeholder]="'PROFILE.CONFIRM_NEW_PASSWORD' | translate"
                formControlName="confirmNewPassword" class="form-input"
                [class.input-error]="(passwordForm.get('confirmNewPassword')?.invalid && passwordForm.get('confirmNewPassword')?.touched) || passwordForm.errors?.['passwordMismatch']">
              <small
                *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmNewPassword')?.touched"
                class="error-text">
                {{ 'PROFILE.PASSWORD_MISMATCH' | translate }}
              </small>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="isPasswordLoading || passwordForm.invalid">
              {{ isPasswordLoading ? ('PROFILE.CHANGING' | translate) : ('PROFILE.CHANGE_PASSWORD' | translate) }}
            </button>
          </div>

          <div *ngIf="passwordSuccessMessage" class="alert alert-success">{{ passwordSuccessMessage }}</div>
          <div *ngIf="passwordErrorMessage" class="alert alert-error">{{ passwordErrorMessage }}</div>

        </form>
      </section>

    </main>
  </div>
</div>