<!-- Loader -->
@if(loading) {
  <div class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading course...</p>
  </div>
}

<!-- Course Player Page -->
@if(!loading && course) {
  <div class="course-player-container">
    <!-- Main Content -->
    <div class="main-content" [class.sidebar-open]="sidebarOpen">
      <!-- Video Player Section -->
      <div class="video-player">
        <div class="video-container">
          @if(course.previewVideoUrl) {
            <video 
              #videoPlayer
              [src]="course.previewVideoUrl"
              (timeupdate)="currentTime = videoPlayer.currentTime; duration = videoPlayer.duration; progressPercent = (currentTime / duration) * 100"
              (play)="isPlaying = true"
              (pause)="isPlaying = false">
            </video>
          } @else {
            <!-- Placeholder when no video -->
            <div class="video-placeholder">
              <div class="code-icon">
                <div class="browser-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <div class="code-symbols">
                  <div class="code-line">
                    <span class="code-text">&lt;/&gt;</span>
                  </div>
                  <div class="code-line short"></div>
                  <div class="code-line"></div>
                  <div class="code-line medium"></div>
                </div>
                <div class="play-button" (click)="togglePlay()">
                  <i class="fas fa-play"></i>
                </div>
                <div class="keyboard-icon"></div>
              </div>
            </div>
          }
          
          <!-- Video Controls -->
          <div class="video-controls">
            <div class="progress-bar">
              <div class="progress-filled" [style.width.%]="progressPercent"></div>
            </div>
            <div class="controls-bottom">
              <div class="controls-left">
                <button class="control-btn play-btn" (click)="togglePlay()">
                  <i class="fas" [class.fa-play]="!isPlaying" [class.fa-pause]="isPlaying"></i>
                </button>
                <button class="control-btn">
                  <i class="fas fa-rotate-right"></i>
                </button>
                <span class="time">{{ formatTime(currentTime) }} / {{ formatTime(duration) }}</span>
                <button class="control-btn speed-control">1x</button>
              </div>
              <div class="controls-right">
                <button class="control-btn">
                  <i class="fas fa-volume-high"></i>
                </button>
                <button class="control-btn">
                  <i class="fas fa-note-sticky"></i>
                </button>
                <button class="control-btn">
                  <i class="fas fa-message"></i>
                </button>
                <button class="control-btn">
                  <i class="fas fa-gear"></i>
                </button>
                <button class="control-btn">
                  <i class="fas fa-expand"></i>
                </button>
                <button class="control-btn">
                  <i class="fas fa-ellipsis"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Next Lecture Arrow -->
        <button class="next-arrow" (click)="goToNextLecture()">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>

      <!-- Navigation Tabs -->
      <div class="nav-tabs-container">
        <button class="nav-tab search-btn">
          <i class="fas fa-magnifying-glass"></i>
        </button>
        <button 
          class="nav-tab" 
          [class.active]="activeTab === 'overview'"
          (click)="setTab('overview')">
          Overview
        </button>
        <button 
          class="nav-tab"
          [class.active]="activeTab === 'qa'"
          (click)="setTab('qa')">
          Q&A
        </button>
        <button 
          class="nav-tab"
          [class.active]="activeTab === 'notes'"
          (click)="setTab('notes')">
          Notes
        </button>
        <button 
          class="nav-tab"
          [class.active]="activeTab === 'announcements'"
          (click)="setTab('announcements')">
          Announcements
        </button>
        <button 
          class="nav-tab"
          [class.active]="activeTab === 'reviews'"
          (click)="setTab('reviews')">
          Reviews
        </button>
        <button 
          class="nav-tab"
          [class.active]="activeTab === 'tools'"
          (click)="setTab('tools')">
          Learning tools
        </button>
      </div>

      <!-- Course Description -->
      <div class="course-description">
        <h1>{{ course.title }}</h1>
        <div class="course-meta">
          <div class="rating">
            <span class="rating-number">4.5</span>
            <i class="fas fa-star"></i>
            <span class="rating-count">1,453 ratings</span>
          </div>
          <div class="students">
            <span class="student-count">20,540</span>
            <span class="student-label">students</span>
          </div>
          <div class="duration">
            <span class="duration-count">12 hours</span>
            <span class="duration-label">Total</span>
          </div>
        </div>
        <div class="last-updated">
          <i class="far fa-clock"></i>
          Last updated December 2025
        </div>

        <!-- Tab Content -->
        <div class="tab-content-area mt-4">
          @if(activeTab === 'overview') {
            <div class="overview-content">
              <h3>About this course</h3>
              <p>{{ course.description }}</p>
              
              <h4 class="mt-4">What you'll learn</h4>
              <ul class="learning-objectives">
                <li>Build a complete eCommerce application with ASP.NET MVC</li>
                <li>Master Entity Framework Core for database operations</li>
                <li>Implement secure authentication and authorization</li>
                <li>Create responsive user interfaces</li>
              </ul>

              <h4 class="mt-4">Requirements</h4>
              <ul>
                <li>Basic knowledge of C# programming</li>
                <li>Understanding of web development concepts</li>
                <li>Visual Studio or VS Code installed</li>
              </ul>
            </div>
          }
          
          @if(activeTab === 'qa') {
            <div class="qa-content">
              <h3>Q&A</h3>
              <p class="text-muted">Ask questions and get answers from instructors and students</p>
            </div>
          }
          
          @if(activeTab === 'notes') {
            <div class="notes-content">
              <h3>Notes</h3>
              <p class="text-muted">Take notes while watching lectures</p>
            </div>
          }
          
          @if(activeTab === 'announcements') {
            <div class="announcements-content">
              <h3>Announcements</h3>
              <p class="text-muted">Stay updated with course announcements</p>
            </div>
          }
          
          @if(activeTab === 'reviews') {
            <div class="reviews-content">
              <h3>Reviews</h3>
              <p class="text-muted">See what other students are saying</p>
            </div>
          }
          
          @if(activeTab === 'tools') {
            <div class="tools-content">
              <h3>Learning Tools</h3>
              <p class="text-muted">Additional resources and tools for learning</p>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" [class.open]="sidebarOpen">
      <div class="sidebar-header">
        <h2>Course content</h2>
        <button class="close-btn" (click)="toggleSidebar()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="course-sections">
        <!-- Loop through sections -->
        <div class="section" *ngFor="let section of sections" [class.collapsed]="section.collapsed">
          <div class="section-header" (click)="toggleSection(section)">
            <i class="fas" [class.fa-chevron-up]="!section.collapsed" [class.fa-chevron-down]="section.collapsed"></i>
            <div class="section-info">
              <h3>{{ section.title }}</h3>
              <span class="section-meta">{{ section.completedLectures }} / {{ section.totalLectures }} | {{ section.totalDuration }}</span>
            </div>
          </div>
          
          <!-- Section Content - Lectures -->
          <div class="section-content" *ngIf="!section.collapsed && section.lectures.length > 0">
            <div class="lecture" *ngFor="let lecture of section.lectures">
              <input 
                type="checkbox" 
                [id]="'lecture-' + lecture.id"
                [checked]="lecture.completed"
                (change)="toggleLectureCompletion(lecture)">
              <label [for]="'lecture-' + lecture.id" (click)="selectLecture(lecture); $event.preventDefault()">
                <span class="lecture-title">{{ lecture.title }}</span>
                <span class="lecture-duration">
                  <i class="far fa-circle-play"></i> {{ lecture.duration }}
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>
}