<div class="reviews-container">
  <div class="max-w-7xl">
    <!-- Header -->
    <div class="header">
      <h1>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.TITLE' | translate }}</h1>
      <div class="course-select">
        <select [(ngModel)]="selectedCourse" (click)="onFilterChange()">
          <option *ngFor="let course of courses" [value]="course">
            {{ course === 'all' ? ('INSTRUCTOR_PERFORMANCE.REVIEWS.ALL_COURSES' | translate) : course }}
          </option>
        </select>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button [class.active]="activeTab === 'reviews'" (click)="activeTab = 'reviews'">
        {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.TAB_REVIEWS' | translate }}
      </button>
      <button [class.active]="activeTab === 'insights'" (click)="activeTab = 'insights'">
        {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.TAB_INSIGHTS' | translate }}
        <span class="badge-new">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.NEW' | translate }}</span>
      </button>
    </div>

    <!-- Filters -->
    <div class="filters-card">
      <div class="filters-row">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="showNotAnswered" (change)="onFilterChange()">
          <span>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_NOT_ANSWERED' | translate }}</span>
        </label>

        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="showWithComment" (change)="onFilterChange()">
          <span>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_HAS_COMMENT' | translate }}</span>
        </label>

        <div class="filter-group">
          <span>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_RATING' | translate }}</span>
          <select [(ngModel)]="selectedRating" (change)="onFilterChange()">
            <option value="all">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_ALL' | translate }}</option>
            <option value="5">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_5_STARS' | translate }}</option>
            <option value="4">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_4_STARS' | translate }}</option>
            <option value="3">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_3_STARS' | translate }}</option>
            <option value="2">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_2_STARS' | translate }}</option>
            <option value="1">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_1_STAR' | translate }}</option>
          </select>
        </div>

        <div class="filter-group">
          <span>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_SORT_BY' | translate }}</span>
          <select [(ngModel)]="sortBy" (change)="onFilterChange()">
            <option value="lowest">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.SORT_LOWEST' | translate }}</option>
            <option value="highest">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.SORT_HIGHEST' | translate }}</option>
            <option value="newest">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.SORT_NEWEST' | translate }}</option>
            <option value="oldest">{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.SORT_OLDEST' | translate }}</option>
          </select>
        </div>

        <button class="export-btn" (click)="exportToCSV()">
          <span class="icon">↓</span>
          {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.EXPORT_CSV' | translate }}
        </button>
      </div>
    </div>

    <!-- Info Banner -->
    <div class="info-banner">
      <div class="info-icon">i</div>
      <p>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.INFO_BANNER' | translate }}</p>
    </div>

    <!-- Reviews List -->
    <div *ngIf="filteredReviews.length === 0" class="no-reviews">
      <p>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.NO_REVIEWS' | translate }}</p>
    </div>

    <div *ngIf="filteredReviews.length > 0" class="reviews-list">
      <div *ngFor="let review of filteredReviews" class="review-card">
        <div class="review-header">
          <div class="student-info">
            <div class="avatar">{{ getInitial(review.studentName) }}</div>
            <div>
              <h3>{{ review.studentName }}</h3>
              <p class="course-name">{{ review.courseTitle }}</p>
            </div>
          </div>
          <div class="rating-section">
            <div class="stars">
              <span *ngFor="let star of getStarArray(review.rating)" [class.filled]="star <= review.rating">
                ★
              </span>
            </div>
            <span *ngIf="!review.answered" class="not-answered-badge">
              {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.FILTER_NOT_ANSWERED' | translate }}
            </span>
          </div>
        </div>

        <p *ngIf="review.comment" class="comment">{{ review.comment }}</p>

        <div class="review-footer">
          <span class="date">{{ review.createdDate }}</span>
          <button *ngIf="!review.answered && replyingTo !== review.id" (click)="handleReply(review.id)"
            class="reply-btn">
            {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.REPLY_BTN' | translate }}
          </button>
        </div>

        <!-- Reply Box -->
        <div *ngIf="replyingTo === review.id" class="reply-box">
          <label>{{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.YOUR_REPLY' | translate }}</label>
          <textarea [(ngModel)]="replyText"
            [placeholder]="'INSTRUCTOR_PERFORMANCE.REVIEWS.PLACEHOLDER_REPLY' | translate" rows="4">
          </textarea>
          <div class="reply-actions">
            <button (click)="handleCancelReply()" class="cancel-btn">
              {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.CANCEL' | translate }}
            </button>
            <button (click)="handleSendReply(review.id)" [disabled]="!replyText.trim()" class="send-btn">
              {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.SEND_REPLY' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Count -->
    <div *ngIf="filteredReviews.length > 0" class="results-count">
      {{ 'INSTRUCTOR_PERFORMANCE.REVIEWS.SHOWING' | translate }} {{ filteredReviews.length }} {{
      'INSTRUCTOR_PERFORMANCE.REVIEWS.OF' | translate }} {{ reviews.length }} {{
      'INSTRUCTOR_PERFORMANCE.REVIEWS.REVIEWS_COUNT' | translate }}
    </div>
  </div>
</div>